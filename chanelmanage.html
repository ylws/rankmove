<!--head start-->
<!--
	1.此区域为公用的头部信息
	2.包含title,样式表部分(css新建公用的global.css,样式沿用以前的版本)
	3.包含logo,nav导航
-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>

<!--内容展示区域-->
<link rel="stylesheet" type="text/css" href="css/chanelmanage.css"/>
		<!--条件选择区域-->
		<div class="center"><!--浮动居中-->
			<div class="centers"><!--1200居中-->
			
				<div class="TCactivemanage" style="margin-top: 67px;">
					
					<div class="TCactivemanage_contents">
						<div class="content" id="content4" style="display: block;">
					
							<div class="listdiv">
								<div class="head">
									<div class="name">筛选条件</div>
									<div class="status">状态</div>
									<div class="pink">修改排序</div>
									<div class="opt">操作</div>
								</div>
								<div class="list" id="a0">
									<!--填充栏目名称-->
									<div class="name">首页</div>
									<!--填充栏目状态-->
									<div class="status">开放</div>
									<!--填充排序号码-->
									<div class="pink">
										<input type="text" />
									</div>
									<!--填充栏目操作-->
									<div class="opt">
										<!--事件：.edit-->
										<div class="edit">
											<span class="editicon"></span>
											<span>编辑</span>
										</div>
										<!--事件：.up-->
										<div class="up">
											<span class="upicon"></span>
											<span>上移</span>
										</div>
										<!--事件：.down-->
										<div class="down">
											<span class="downicon"></span>
											<span>下移</span>
										</div>
										<!--事件：.btnset-->
										<div class="btnset">设置为开放</div>
										<!--事件：.del-->
										<div class="del">
											<span class="delicon"></span>
											<span>删除</span>
										</div>
									</div>
								</div>
								<div class="list" id="a1">
									<!--填充栏目名称-->
									<div class="name">学科</div>
									<!--填充栏目状态-->
									<div class="status">开放</div>
									<!--填充排序号码-->
									<div class="pink">
										<input type="text" />
									</div>
									<!--填充栏目操作-->
									<div class="opt">
										<!--事件：.edit-->
										<div class="edit">
											<span class="editicon"></span>
											<span>编辑</span>
										</div>
										<!--事件：.up-->
										<div class="up">
											<span class="upicon"></span>
											<span>上移</span>
										</div>
										<!--事件：.down-->
										<div class="down">
											<span class="downicon"></span>
											<span>下移</span>
										</div>
										<!--事件：.btnset-->
										<div class="btnset">设置为开放</div>
										<!--事件：.del-->
										<div class="del">
											<span class="delicon"></span>
											<span>删除</span>
										</div>
									</div>
								</div>
								<div class="list" id="a2">
									<!--填充栏目名称-->
									<div class="name">学段</div>
									<!--填充栏目状态-->
									<div class="status">开放</div>
									<!--填充排序号码-->
									<div class="pink">
										<input type="text" />
									</div>
									<!--填充栏目操作-->
									<div class="opt">
										<!--事件：.edit-->
										<div class="edit">
											<span class="editicon"></span>
											<span>编辑</span>
										</div>
										<!--事件：.up-->
										<div class="up">
											<span class="upicon"></span>
											<span>上移</span>
										</div>
										<!--事件：.down-->
										<div class="down">
											<span class="downicon"></span>
											<span>下移</span>
										</div>
										<!--事件：.btnset-->
										<div class="btnset">设置为开放</div>
										<!--事件：.del-->
										<div class="del">
											<span class="delicon"></span>
											<span>删除</span>
										</div>
									</div>
								</div>
								<div class="list" id="a3">
									<!--填充栏目名称-->
									<div class="name">年级</div>
									<!--填充栏目状态-->
									<div class="status">开放</div>
									<!--填充排序号码-->
									<div class="pink">
										<input type="text" />
									</div>
									<!--填充栏目操作-->
									<div class="opt">
										<!--事件：.edit-->
										<div class="edit">
											<span class="editicon"></span>
											<span>编辑</span>
										</div>
										<!--事件：.up-->
										<div class="up">
											<span class="upicon"></span>
											<span>上移</span>
										</div>
										<!--事件：.down-->
										<div class="down">
											<span class="downicon"></span>
											<span>下移</span>
										</div>
										<!--事件：.btnset-->
										<div class="btnset">设置为开放</div>
										<!--事件：.del-->
										<div class="del">
											<span class="delicon"></span>
											<span>删除</span>
										</div>
									</div>
								</div>
								<div class="list" id="a4">
									<!--填充栏目名称-->
									<div class="name">学校</div>
									<!--填充栏目状态-->
									<div class="status">开放</div>
									<!--填充排序号码-->
									<div class="pink">
										<input type="text" />
									</div>
									<!--填充栏目操作-->
									<div class="opt">
										<!--事件：.edit-->
										<div class="edit">
											<span class="editicon"></span>
											<span>编辑</span>
										</div>
										<!--事件：.up-->
										<div class="up">
											<span class="upicon"></span>
											<span>上移</span>
										</div>
										<!--事件：.down-->
										<div class="down">
											<span class="downicon"></span>
											<span>下移</span>
										</div>
										<!--事件：.btnset-->
										<div class="btnset">设置为开放</div>
										<!--事件：.del-->
										<div class="del">
											<span class="delicon"></span>
											<span>删除</span>
										</div>
									</div>
								</div>
								<div class="list" id="a5">
									<!--填充栏目名称-->
									<div class="name">栏目名称5</div>
									<!--填充栏目状态-->
									<div class="status">开放</div>
									<!--填充排序号码-->
									<div class="pink">
										<input type="text" />
									</div>
									<!--填充栏目操作-->
									<div class="opt">
										<!--事件：.edit-->
										<div class="edit">
											<span class="editicon"></span>
											<span>编辑</span>
										</div>
										<!--事件：.up-->
										<div class="up">
											<span class="upicon"></span>
											<span>上移</span>
										</div>
										<!--事件：.down-->
										<div class="down">
											<span class="downicon"></span>
											<span>下移</span>
										</div>
										<!--事件：.btnset-->
										<div class="btnset">设置为开放</div>
										<!--事件：.del-->
										<div class="del">
											<span class="delicon"></span>
											<span>删除</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	
<!--foot end-->

<!--js start-->
<!--
	1.此处放置当前页面私有的js部分
-->

		<script type="text/javascript">
			function pinkfn(obj){
				this.fatherClass=obj['class'],
				this.optClass=obj['optclass'],
				this.editClass=obj['editclass'],
				this.upClass=obj['upclass'],
				this.btnsetClass=obj['btnsetclass'],
				this.downClass=obj['downclass'],
				this.listClass=obj['listclass'],
				this.ajaxfnresult=obj['ajaxfnresult'],
				this.ajaxfn=obj['ajaxfn'];
				this.init();
			}
			pinkfn.prototype={
				"parentEls":function(){
					return document.getElementsByClassName(this.fatherClass)[0];
				},
				"init":function(){
					this.up();
					this.down();
					//this.keydownevent();
				},
				"up":function(){
					this.eventsupdown("up")	
				},
				"down":function(){
					this.eventsupdown("down")	
				},
				"eventsupdown":function(updown){
					var _this=this;
					var listobj=this.parentEls().getElementsByClassName(this.listClass);
					for(var i=0;i<listobj.length;i++){
						listobj[i].setAttribute("index",i);
						listobj[i].removeAttribute("style");
//						listobj[i].getElementsByClassName("pink")[0].getElementsByTagName("input")[0].value=i+1;
//						listobj[i].getElementsByClassName("pink")[0].getElementsByTagName("input")[0].setAttribute("relval",i+1);
						var opts=listobj[i].getElementsByClassName(this.optClass)[0];
						opts.getElementsByClassName(this.downClass)[0].style.display="block";
						opts.getElementsByClassName(this.upClass)[0].style.display="block";
						if(i==0){
							opts.getElementsByClassName(this.upClass)[0].style.display="none";
						}else if(i==listobj.length-1){
							opts.getElementsByClassName(this.downClass)[0].style.display="none";
						}
						else{
							opts.getElementsByClassName(this.downClass)[0].style.display="block";
						}
						if(updown=="up"){
							var upels=listobj[i].getElementsByClassName(this.optClass)[0].getElementsByClassName(this.upClass)[0];
							upels.onclick=function(){
								var parentEls=this.parentNode.parentNode;
								var temphtml=parentEls.cloneNode(true);
								var thisindex=parentEls.getAttribute("index");
								temphtml.setAttribute("index",thisindex-1);
								parentEls.previousElementSibling.setAttribute("index",thisindex);
								var a=parentEls.getAttribute("id"),b=parentEls.previousElementSibling.getAttribute("id");
								_this.ajaxfn(a,b,_this);
								var timer=setInterval(function(){
									if(_this.ajaxfnresult){
										clearInterval(timer);
										parentEls.parentNode.insertBefore(temphtml,parentEls.previousElementSibling)
										parentEls.remove();
										_this.eventsupdown("up");
										_this.eventsupdown("down");
									}
									else{
										if(_this.ajaxfnresult==false){
											_this.ajaxfnresult
										}
									}
								},100)
							}
						}
						if(updown=="down"){
							var downels=listobj[i].getElementsByClassName(this.optClass)[0].getElementsByClassName(this.downClass)[0];
							downels.onclick=function(){
								var parentEls=this.parentNode.parentNode;
								var temphtml=parentEls.cloneNode(true);
								var thisindex=parentEls.getAttribute("index");
								temphtml.setAttribute("index",thisindex+1);
								parentEls.nextElementSibling.setAttribute("index",thisindex);
								var a=parentEls.getAttribute("id"),b=parentEls.nextElementSibling.getAttribute("id");
								_this.ajaxfn(a,b,_this);
								var timer=setInterval(function(){
									if(_this.ajaxfnresult){
										clearInterval(timer);
										if((parseInt(thisindex)+1)==(listobj.length-1))
										{
											_this.parentEls().appendChild(temphtml)
										}
										else
										{
											parentEls.parentNode.insertBefore(temphtml,parentEls.nextElementSibling.nextElementSibling)
										}
										parentEls.remove();
										_this.eventsupdown("up");
										_this.eventsupdown("down");
									}
									else{
										if(_this.ajaxfnresult==false){
											_this.ajaxfnresult
										}
									}
								},100)
								
								
							}
						}	
					}
				},
				"keydownevent":function(){
					var listobj=this.parentEls().getElementsByClassName(this.listClass);
					var _this=this;
					document.onkeydown=function(e){
						var targetval=e.target.getAttribute("relval");
						var ekc=parseInt(e.keyCode);
						//判断数字
						if((ekc>=48&&ekc<=57)||(ekc>=96&&ekc<=105)||(ekc>=112&&ekc<=123))
						{
						}
						else{
							alert("请输入数字")
						}
					}
					document.onkeyup=function(e){
						var targetval=e.target.getAttribute("relval");
						var ekc=parseInt(e.keyCode);
						//判断数字
						if((ekc>=48&&ekc<=57)||(ekc>=96&&ekc<=105))
						{
							var targenum=parseInt(e.target.value);
							if(targenum>listobj.length){
								alert("不存在该条目，请重试！")
								
							}
							else{
								var getnum=ekc%48-1;//对48取余数，就是要交换的位置
								if(targetval==null){
									targetval=1;
								}
								var nownum=parseInt(targetval)-1;
								//互换位置
								if(nownum!=NaN){
									//需要判断切换到那个位置
									if(getnum!=nownum){//去除输入的数值与当前元素相同
										if(getnum!=(listobj.length-1)){//交换到除最后一个元素以外的元素
											var clonehtml=listobj[nownum].cloneNode(true);//当前元素元素的复件
											console.log(clonehtml)
											listobj[nownum].remove();
											listobj[getnum].parentNode.insertBefore(clonehtml,listobj[getnum])
										}
										else if(getnum==listobj.length-1){//交换到最后一个元素
											var clonehtml=listobj[nownum].cloneNode(true);//当前元素元素的复件
											listobj[getnum].parentNode.appendChild(clonehtml);
											listobj[nownum].remove();
										}
										_this.up();
										_this.down();
									}
								}
								
							}
						}
						else if(ekc>=112&&ekc<=123){
							//费-费2
						}
					}
				}
			}
			var pinks=new pinkfn({
				"class":"listdiv",
				"listclass":"list",
				"optclass":"opt",
				"editclass":"edit",
				"upclass":"up",
				"downclass":"down",
				"btnsetclass":"btnset",
				"ajaxfnresult":false,
				"ajaxfn":function(a,b,_this){_this.ajaxfnresult=true}
			})
			
		</script>
<!--js end-->
	</body>
</html>
